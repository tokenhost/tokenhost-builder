{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://tokenhost.com/schemas/tokenhost-release-manifest.schema.json",
  "title": "Token Host Release Manifest",
  "description": "Canonical manifest describing a Token Host build + deployments + hosted UI release.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "manifestVersion",
    "schemaVersion",
    "schemaHash",
    "generatorVersion",
    "toolchain",
    "release",
    "app",
    "collections",
    "deployments",
    "ui",
    "features",
    "signatures"
  ],
  "properties": {
    "manifestVersion": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?(?:\\+[0-9A-Za-z-]+(?:\\.[0-9A-Za-z-]+)*)?$"
    },
    "schemaVersion": { "type": "string" },
    "schemaHash": {
      "type": "string",
      "description": "Canonical schema digest. v1 uses RFC 8785 canonicalization + SHA-256.",
      "pattern": "^sha256:[0-9a-f]{1,}$"
    },
    "generatorVersion": { "type": "string" },
    "toolchain": {
      "type": "object",
      "additionalProperties": false,
      "required": ["node", "solc"],
      "properties": {
        "node": { "type": "string" },
        "solc": { "type": "string" },
        "containerDigest": { "type": "string" }
      }
    },
    "release": {
      "type": "object",
      "additionalProperties": false,
      "required": ["releaseId", "publishedAt"],
      "properties": {
        "releaseId": { "type": "string" },
        "supersedesReleaseId": { "type": ["string", "null"] },
        "publishedAt": { "type": "string", "format": "date-time" }
      }
    },
    "app": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "slug"],
      "properties": {
        "name": { "type": "string" },
        "slug": { "type": "string" }
      }
    },
    "collections": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "collectionId"],
        "properties": {
          "name": { "type": "string" },
          "collectionId": { "type": "string", "pattern": "^0x[0-9a-fA-F]{64}$" }
        }
      }
    },
    "deployments": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["role", "chainId", "chainName", "appContractAddress", "verified"],
        "properties": {
          "role": { "type": "string", "enum": ["primary", "legacy"] },
          "schemaVersion": { "type": "string" },
          "schemaHash": { "type": "string", "pattern": "^sha256:[0-9a-f]{1,}$" },
          "chainId": { "type": "integer", "minimum": 1 },
          "chainName": { "type": "string" },
          "appContractAddress": { "type": "string", "pattern": "^0x[0-9a-fA-F]{40}$" },
          "verified": { "type": "boolean" },
          "blockNumber": { "type": "integer", "minimum": 0 },
          "chainConfig": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "url": { "type": "string", "format": "uri" },
              "digest": { "type": "string", "pattern": "^sha256:[0-9a-f]{1,}$" },
              "chainConfigVersion": { "type": "string" }
            }
          }
        },
        "allOf": [
          {
            "if": { "properties": { "role": { "const": "legacy" } }, "required": ["role"] },
            "then": { "required": ["schemaVersion", "schemaHash"] }
          }
        ]
      }
    },
    "ui": {
      "type": "object",
      "additionalProperties": false,
      "required": ["bundleHash", "baseUrl", "wellKnown"],
      "properties": {
        "bundleHash": { "type": "string", "pattern": "^sha256:[0-9a-f]{1,}$" },
        "baseUrl": { "type": "string", "format": "uri" },
        "wellKnown": { "type": "string" }
      }
    },
    "features": {
      "type": "object",
      "additionalProperties": false,
      "required": ["indexer", "delegation", "uploads", "onChainIndexing"],
      "properties": {
        "indexer": { "type": "boolean" },
        "delegation": { "type": "boolean" },
        "uploads": { "type": "boolean" },
        "onChainIndexing": { "type": "boolean" }
      }
    },
    "errorCatalog": {
      "type": "object",
      "description": "Optional mapping of logical error names to selectors for tooling.",
      "additionalProperties": { "type": "string" }
    },
    "signatures": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["alg", "sig"],
        "properties": {
          "alg": { "type": "string" },
          "keyId": { "type": "string" },
          "sig": { "type": "string" }
        }
      }
    },
    "extensions": {
      "type": "object",
      "description": "Extension point for forward-compatible metadata.",
      "additionalProperties": true
    }
  }
}

